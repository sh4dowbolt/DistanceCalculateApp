# Route Destination App

## Описание проекта
Route Destination App - это Spring Boot приложение, которое рассчитывает расстояние между двумя точками на карте, используя координаты, полученные из разных геокодирующих сервисов (Яндекс.Карты и DaData). Приложение позволяет получать расстояние в разных единицах измерения (километры, метры, сантиметры).

## Основной функционал

### 1. Расчет расстояния
- Принимает адрес в виде строки
- Получает координаты адреса из двух сервисов:
  - Яндекс.Карты (геокодирование)
  - DaData (геокодирование)
- Рассчитывает расстояние между полученными координатами
- Возвращает результат в выбранной единице измерения

### 2. Единицы измерения
Поддерживаемые единицы измерения:
- Километры (KM)
- Метры (M)
- Сантиметры (CENTIMETER)

### 3. Сохранение результатов
- Все расчеты сохраняются в базе данных
- Для каждого расчета сохраняется:
  - Исходный адрес
  - Координаты от Яндекс.Карт
  - Координаты от DaData
  - Рассчитанное расстояние
  - Дата и время расчета

## Технические механизмы

### 1. Архитектура
- REST API на Spring Boot
- Многослойная архитектура:
  - Controller (AdressController) - обработка HTTP запросов
  - Service (CalculationService, YandexMapService, DadataService) - бизнес-логика
  - Repository (DifferenceCoordinateRecordRepository) - работа с базой данных
  - DTO - объекты передачи данных
  - Entity - сущности базы данных
  - Util - вспомогательные классы

### 2. Внешние интеграции
- Яндекс.Карты API
  - Геокодирование адресов
  - Получение координат
- DaData API
  - Стандартизация адресов
  - Геокодирование
  - Получение координат

### 3. База данных
- MySQL 8.0
- Таблицы:
  - coordinates (хранение координат)
  - calculate_events (хранение результатов расчетов)
- Конфигурация через переменные окружения
- Поддержка Docker volumes для сохранения данных

### 4. Безопасность и валидация
- Валидация входных данных
- Проверка кодировки (UTF-8)
- Обработка ошибок API
- Защита от некорректных запросов
- Безопасное хранение чувствительных данных:
  - Все чувствительные данные хранятся в переменных окружения
  - Использование Docker secrets для API ключей
  - Безопасная конфигурация базы данных
  - Отсутствие чувствительных данных в коде и конфигурационных файлах

### 5. Конфигурация
- Настройки через переменные окружения
- Конфигурация внешних сервисов через Docker
- Настройка базы данных через Docker Compose
- Настройка путей API
- Поддержка различных профилей Spring (dev, prod)

### 6. Docker и контейнеризация
- Мультиконтейнерное приложение (Docker Compose)
- Сервисы:
  - MySQL 8.0
  - Spring Boot приложение
- Особенности:
  - Health checks для всех сервисов
  - Изолированная сеть
  - Управление томами для данных
  - Автоматический перезапуск при сбоях
  - Зависимости между сервисами

## API Endpoints

### POST /getDistance
Расчет расстояния между точками

Параметры:
- Request Body: String[] (массив с одним адресом)
- Query Parameter: measureType (KM, M, CENTIMETER, по умолчанию KM)

Ответ:
```json
{
    "difference": number,
    "measureType": string
}
```

## Используемые технологии
- Java 17
- Spring Boot 3.5.0
- Spring Data JPA
- MySQL 8.0
- RestClient
- Lombok
- Jackson
- Maven
- Docker
- Docker Compose

## Особенности реализации
1. Двойная проверка координат через разные сервисы
2. Гибкая система единиц измерения
3. Сохранение истории расчетов
4. Обработка ошибок и валидация
5. Модульная структура кода
6. Контейнеризация с Docker
7. Безопасное хранение конфигурации

## Требования к системе
- Java 17 или выше
- Docker и Docker Compose
- Доступ к API Яндекс.Карт
- Доступ к API DaData

## Конфигурация
Необходимые переменные окружения (.env):
```
# MySQL Configuration
MYSQL_ROOT_PASSWORD=your_root_password
MYSQL_DATABASE=your_database_name
MYSQL_USER=your_username
MYSQL_PASSWORD=your_password

# Spring Configuration
SPRING_PROFILES_ACTIVE=dev

# API Keys
DADATA_API_KEY=your_dadata_api_key
DADATA_SECRET_KEY=your_dadata_secret_key
YANDEX_API_KEY=your_yandex_api_key
```

## Запуск приложения
1. Создать файл .env с необходимыми переменными окружения
2. Запустить приложение через Docker Compose:
```bash
docker-compose up -d
```
3. Проверить статус сервисов:
```bash
docker-compose ps
```

## Мониторинг
- Health checks доступны через Spring Actuator (/actuator/health)
- Мониторинг состояния контейнеров через Docker
- Логи доступны через Docker logs 